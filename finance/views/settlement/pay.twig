{% set menu_name = "balance" %}
{% set sidebar_name = "买手结算" %}
{% extends '@view/layouts/main.twig' %}
{% block content %}
<link rel="stylesheet" href="/ace/css/blue.css">
<div class="breadcrumbs breadcrumbs-fixed" id="breadcrumbs">
	<script type="text/javascript">
		try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
	</script>
	<!-- 面包屑 开始 -->
	<ul class="breadcrumb">
		<li>
			<i class="icon-home home-icon"></i>
			<a href="#">财务管理</a>
		</li>
		<li>
			<a href="#">买手结算</a>
		</li>

		<li class="active">结算详情</li>
	</ul><!-- 面包屑 结束 -->
</div><!-- 主体topbar 开始 -->
<!-- page-content 开始 -->
<div class="page-content">
	<!-- row 开始 -->
	<div class="row">
		<!-- col 开始 -->
		<div class="col-xs-12">
			<div class="space-10"></div>
			<div class="balance-account-list">
				<header>	
					<h4>结算清单</h4>
					<div>
						<span>结算人：{{ App.user.identity.username }}</span>
						<time>结算时间：
							{% if params.begin_time is defined and params.end_time is defined %}
								{{ params.begin_time }} - {{ params.end_time }}
							{% else %}
								{{ begin_time|date('Y-m-d H:i:s') }} - {{ end_time|date('Y-m-d H:i:s') }}
							{% endif %}
						</time>
					</div>
				</header>
				<div class="space-6"></div>
				
				<div class="table-responsive results-tab">
					{% for key,result in results %}
					<table class="table table-hover">
						<thead>
							<tr>
								<th class="center">
									<div class="check-all" ><input class="checkAll" type="checkbox" ></div>
								</th>
								<th class="center">{{ result.buyer_realname }}</th>
								<th class="center">{{ result.buyer_nickname }} ({{ result.buyer_id }})</th>
								<th class="center">订单: {{ result.orders|count }}</th>
								<th class="center outstanding-amount">待结算: <span>{{ result.sumprice|sprintf }}</span></th>
								<th class="center adjust-amount">调整: 
									<span class="">
										{{ result.adjust|sprintf }}
									</span>
								</th>
								<th class="center final-amount">应结: <span>{{ (result.sumprice + result.adjust)|sprintf }}</span></th>
								<th class="center">支付宝：{{ result.banknumber }}</th>
							</tr>
						</thead>
						<tbody class="order_list">		
							{% for data in result.orders %}	
							<tr class="info-detail" data-id="{{ data.orders.id }}">
								<td class="center">
									<div class="check-box"><input class="checkBox" type="checkbox" ></div>
								</td>
								<td class="order-id">{{ data.orders.id }}</td>
								<td>{{ data.getOrderSettlementStatus() }}</td>
								<td colspan="2">{{ data.orders.stocks.name }}</td>
								<td class="outstanding-single-amount">金额: <span>{{ data.orders.sum_price|sprintf }}</span></td>
								<td class="adjust-single-amount">调整: 
									<span class="{% if data.adjust > 0 %}reduce{% elseif data.adjust < 0 %}increase{% else %}{% endif %}">
										{{ data.adjust|sprintf }}
									</span>
								</td>
								<td class="final-single-amount">实结: <span>{{ (data.orders.sum_price + data.adjust)|sprintf }}</span></td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
					{% endfor %}
					<div class="collection">
						<span>买手: <em id="buyerNums"></em></span>
						<span>订单: <em id="orderNums">343</em></span>
						<span>待结金额: <em id="outstandingAmount">12,122,657.00</span>
						<span>调整金额: <em id="adjustAmount" class="increase">- 123.00</em></span>
						<span>应结金额: <em class="prompt" id="finalAmount">12,122,123.00</em></span>
						<button id="confirmAccount"  data-toggle="modal" data-target="#confirmAccountModal" class="btn btn-primary btn-sm">确认结算</button>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>
<!-- 确认结算 dialog -->
<div class="modal fade" id="confirmAccountModal" tabindex="-1" role="dialog" aria-labelledby="confirmAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog">

    <div class="modal-content">
    	<form action="/settlement/clear" method="post" onsubmit="return checkOrderIds();">
    		<input type="hidden" value="{{ App.request.getCsrfToken() }}" name="{{ App.request.csrfParam }}">
    		{% if params.begin_time is defined and params.end_time is defined %}
				<input type="hidden" name="begin_time" value="{{ params.begin_time }}" />
    			<input type="hidden" name="end_time" value="{{ params.end_time }}" />
			{% else %}
				<input type="hidden" name="begin_time" value="{{ begin_time|date('Y-m-d H:i:s') }}" />
    			<input type="hidden" name="end_time" value="{{ end_time|date('Y-m-d H:i:s') }}" />
			{% endif %}
    		<input id="batchSettleMent" type="hidden" name="order_ids" value="">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="confirmAccountModalLabel">确认结算</h4>
      </div>
      {# <div class="modal-body clearfix">
        <p>请输入结算密码:</p>
        <input class="col-xs-4" type="password" id="form-field-5" >
      </div> #}
      <div class="modal-body">
		<div class="adjustNum clearfix">
			<p>确定要结算这批订单吗？</p>
		</div>			          
		</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">取消</button>
        <button type="submit" class="btn btn-primary btn-sm">确定结算</button>
      </div>
  		</form>
    </div>
  </div>
</div>
<script src="/ace/js/icheck.min.js"></script> 
<script type="text/javascript" src="/ace/js/balance-accout.js"></script>
{% endblock %}