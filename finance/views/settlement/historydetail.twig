{% set menu_name = "balance" %}
{% set sidebar_name = "历史结算" %}
{% extends '@view/layouts/main.twig' %}
{% block content %}
<link rel="stylesheet" href="/ace/css/blue.css">
<div class="breadcrumbs breadcrumbs-fixed" id="breadcrumbs">
	<script type="text/javascript">
		try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
	</script>
	<!-- 面包屑 开始 -->
	<ul class="breadcrumb">
		<li>
			<i class="icon-home home-icon"></i>
			<a href="#">财务管理</a>
		</li>
		<li>
			<a href="/settlement/list">结算历史</a>
		</li>

		<li class="active">结算清单</li>
	</ul><!-- 面包屑 结束 -->
</div><!-- 主体topbar 开始 -->
<!-- page-content 开始 -->
<div class="page-content">
	<!-- row 开始 -->
	<div class="row">
		<!-- col 开始 -->
		<div class="col-xs-12">
			<div class="space-10"></div>
			<div class="balance-account-list">
				<header>	
					<h4>结算清单</h4>
					<div>
						<span>结算人：{{ App.user.identity.username }}</span>
						<time>结算时间：
							{{ settlement.delivery_begin_time|date('Y-m-d H:i:s') }} - {{ settlement.delivery_end_time|date('Y-m-d H:i:s') }}
						</time>
					</div>
				</header>
				<div class="space-6"></div>
				
				<div class="table-responsive results-tab">
					{% for key,result in results %}
					<table class="table table-hover">
						<thead>
							<tr>
								<th class="center">{{ result.buyer_realname }}</th>
								<th class="center">{{ result.buyer_nickname }} ({{ result.buyer_id }})</th>
								<th class="center">订单: {{ result.orders|count }}</th>
								<th class="center outstanding-amount">待结算: <span>{{ result.sumprice|sprintf }}</span></th>
								<th class="center adjust-amount">调整: <span class="{% if result.adjust > 0 %}reduce{% elseif result.adjust < 0 %}{% else %}increase{% endif %}">
										{{ result.adjust|sprintf }}
									</span></th>
								<th class="center final-amount">应结: <span>{{ (result.sumprice + result.adjust)|sprintf }}</span></th>
								<th class="cnter">支付宝：{{ result.banknumber }}</th>
							</tr>
						</thead>
						<tbody class="order_list">		
							{% for data in result.orders %}					
							<tr class="info-detail" data-id="{{ data.orders.id }}">
								<td class="order-id">{{ data.orders.id }}</td>
								<td>{{ data.getOrderSettlementStatus() }}</td>
								<td colspan="2">{{ data.orders.stocks.name }}</td>
								<td>金额: {{ data.orders.sum_price|sprintf }}</td>
								<td>调整: <span class="{% if data.adjust > 0 %}reduce{% elseif data.adjust < 0 %}{% else %}increase{% endif %}">
										{{ data.adjust|sprintf }}
									</span></td>
								<td>实结: {{ (data.orders.sum_price + data.adjust)|sprintf }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
					{% endfor %}
					<div class="collection">
						<span>买手: <em id="buyerNums"></em></span>
						<span>订单: <em id="orderNums">343</em></span>
						<span>待结金额: <em id="outstandingAmount">12,122,657.00</span>
						<span>调整金额: <em id="adjustAmount" class="reduce">- 123.00</em></span>
						<span>应结金额: <em id="finalAmount">12,122,123.00</em></span>
						<button id="confirmAccount"  data-toggle="modal" data-target="#printModal" class="btn btn-primary btn-sm">打印清单</button>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>
<!-- 确认结算 dialog -->
<div class="modal fade" id="printModal" tabindex="-1" role="dialog" aria-labelledby="outputModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="outputModalLabel">选择操作</h4>
      </div>
      <div class="modal-body clearfix">
        <button id="printBtn" data-id="{{ settlement_id }}" type="button" class="btn btn-primary btn-sm btn-block">打印清单</button>
        <button id="exportBtn" data-id="{{ settlement_id }}"type="button" class="btn btn-primary btn-sm btn-block">导出清单</button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">取消</button>
      </div>
    </div>
  </div>
</div>

<script src="/ace/js/icheck.min.js"></script> 
<script type="text/javascript" src="/ace/js/history-detail.js"></script>
{% endblock %}