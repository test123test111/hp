{% set menu_name = "refund" %}
{% set sidebar_name = "退款列表" %}
{% extends '@view/layouts/main.twig' %}
{% block content %}
<link rel="stylesheet" href="/ace/css/bootstrap-datetimepicker.min.css">
<link rel="stylesheet" href="/ace/css/blue.css">

<div class="breadcrumbs breadcrumbs-fixed" id="breadcrumbs">
	<script type="text/javascript">
		try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
	</script>
	<!-- 面包屑 开始 -->
	<ul class="breadcrumb">
		<li>
			<i class="icon-home home-icon"></i>
			<a href="#">退款管理</a>
		</li>

		<li class="active">退款列表</li>
	</ul><!-- 面包屑 结束 -->
</div><!-- 主体topbar 开始 -->
<!-- page-content 开始 -->
<div class="page-content">
	{% include "@app/views/layouts/notice.twig" %}
	<!-- row 开始 -->
	<div class="row">
		<!-- col 开始 -->
		<div class="col-xs-12">
			<!-- 搜索区域 开始 -->
			<div class="search-area col-sm-12">
				<!-- 搜索条件 开始 -->
				<div class="search-box">
					<div class="space-10"></div>
					<!-- 分类搜索 开始 -->
					<div class="classified-search">
						<div class="input-group">
							<form method="get">
								<input id="searchContent" type="text" name="order_id" value="{% if params.order_id is defined %}{{ params.order_id }}{% endif %}" class="search-bar form-control search-query input-sm" placeholder="请输入要搜索的内容" />
								<div class="classify-info btn-group">
									<button type="button" id="classifiedBtn" data-toggle="dropdown" class="classified-btn btn btn-xs btn-primary dropdown-toggle">
										<em>订单ID</em>
										<span class="icon-caret-down icon-on-right"></span>
									</button>

									<ul id="searchMenu" class="dropdown-menu dropdown-default">
										<li><a href="#">订单ID</a></li>
										
									</ul>
								</div>
								<span class="search-btn input-group-btn">
									<button type="submit" class="btn btn-primary btn-xs">
										搜索
										<i class="icon-search icon-on-right bigger-110"></i>
									</button>
								</span>
							</form>
						</div>
						<span class="info">可搜索订单ID</span>
					</div>
					<!-- 分类搜索 结束 -->
					
				</div>	
				<!-- 搜索条件 结束 -->
				<!-- 搜索结果 开始 -->
				<div class="search-results">
					<div class="space-10"></div>
					<div class="results-tab tabbable">
						<ul class="nav nav-tabs" id="tabLevelOne">
							<li class="{% if params.status is not defined or params.status == '0' %}active{% endif %} pay-state"><a href="/refund/list">待退款</a></li>
							<li class="{% if params.status is defined and params.status == '2' %}active{% endif %} pay-state"><a href="/refund/list?status=2">已退款</a></li>
							<li class="{% if params.status is defined and params.status =="all" %}active{% endif %} pay-state"><a href="/refund/list?status=all">全部</a></li>
						</ul>

						<div class="tab-content">
							<div id="home" class="tab-pane in active">
								<!-- table responsive -->
								<div class="table-responsive">
									<table class="table table-hover">
										<thead>
											<tr>
												<th>
													<div class="check-all"  ><input id="checkAll" type="checkbox" ></div>
												</th>	
												<th class="center">订单详情</th>
												<th class="center">流水ID</th>
												<th class="center">退款状态</th>	
												<th class="center">付款方式</th>
												<th class="center trade-num">交易订单号</th>
												<th class="center">申请时间</th>	
												<th class="center">联系人</th>
												<th class="center">操作</th>
											</tr>
										</thead>
										<tbody>
											{% for result in results %}
											<tr class="placeholder">
								              <td colspan="6"></td>
								            </tr>
											<tr class="info">
												
												<td class="order-num left" colspan="5">
									            	<strong>订单编号：<em class="number">{{ result.order_id }}</em></strong>
									             </td>
									             <td class="time" colspan="4">
									                <p class="">更新时间：<time>{{ result.orders.update_time|date('Y-m-d H:i:s')}}</time></p>
									            </td>
											</tr>
											<tr class="info-detail">
												<td >
													<div class="check-box"><input class="checkBox" type="checkbox" ></div>
												</td>
												<td class="order-info">
													
													<img src="{{ staticDomain }}{{ result.getOrderImg() }}" alt="goods">
													<div class="info">
														<h6>{{ result.orders.stocks.name }}</h6>
														{# <p><em>{{ result.orders.stockAmount.sku_value }}</em></p> #}
													<div>
													
												</td>
												<td class="rasult-id" data-result="{{ result.id }}">
													<div class="space-6"></div>
													<span  >{{ result.id }}</span>
												</td>
												<td class="refund-status">
													<div class="space-6"></div>
													<span class="center">{% if result.status == 0 %}正在等待退款{% elseif result.status == 1 %}退款中{% elseif result.status == 2 %}退款成功{% else %}退款失败{% endif %}</span>
														<span class="center special-color">{{ result.reason }}</span>
												</td>
												<td class="pay-num">
													{% set need_amount = result.getNeedRefundAmount() %}
													{% if result.orders.sum_price != need_amount %}
													<del class="center special-color">{{ result.orders.sum_price|sprintf }}</del>
													{% endif %}
									                <span class="center amount-num">{{ need_amount }}</span>
									                <span class="center">付款方式:
									                	{# <a href="#">支付信息</a> #}
									                	{% if result.orders.payments is defined %}
									                	{% if result.orders.payments.source == 'zfb' %}
									                		支付宝
									                	{% elseif result.orders.payments.source == 'zfb_client'%}
									                		支付宝客户端
									                	{% else %}
									                		微信
									                	{% endif %}
									                {% endif %}
									                </span>
												</td>
												<td class="trade-num">
													<span>
														{% if result.orders.payments is defined %}
														{{ result.orders.payments.trade_no }}
														{% endif %}
													</span>
												</td>
												<td>
													<time>
														<div class="space-6"></div>
									                  	<span class="center">{{ result.create_time|date('Y-m-d') }}<span>
									                  	<span class="center">{{ result.create_time|date('H:i:s')}}</span>
									                </time>
												</td>
												<td>
													<div class="space-6"></div>
													<span class="center">{{ result.orders.name }}</span>
														<span class="center">{{ result.orders.cellphone }}</span>
												</td>
												<td class="operate">
													
													<div class="space-6"></div>
													<div class="center">
														{% if params.status is not defined or params.status == '0' %}
														<div class="edit center">
										                    <div class="center"><i class="icon-remove bigger-160"></i></div>
										                    <p class="center"><a class="reject" href="#" data-result="{{result.id}}" data-toggle="modal" data-target="#rejectRefundModal">拒绝</a></p>
										                </div>
										                <div class="edit center">
										                    <div class="center"><i class="icon-check bigger-160"></i></div>
										                    <p class="center"><a class="agreement" data-result="{{result.id}}" href="#" data-toggle="modal" data-target="#agreementModal">同意</a></p>

										                </div>
										                {% endif %}
										                <div class="note center">
										                    <div class="center"><i class="icon-comment-alt bigger-160"></i></div>
										                    <p class="center"><a id="note" href="#">备注</a></p>
										                </div>
									                </div>
												</td>
											</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
								<!-- table responsive -->
								<!-- Pagination 开始 -->
								<div class="pages">
									 {% if params.status is not defined or params.status == '0' %}
									<button type="button" id="fullRefundBtn" class="full-refund btn btn-xs btn-primary" data-toggle="modal" data-target="#fullRefundModal">一键退款</button>
									{% endif %}
									<p class="search-sum">共{{ count }}个结果</p>
									
									<ul class="pagination">
										{{ widget('\\yii\\widgets\\LinkPager',{'pagination':pages}) }}
									</ul>
									
								</div>
								<!-- pagination 结束 -->
							</div>
						</div>
					</div>
				
				</div>
				<!-- 搜索结果 结束 -->
			</div>
			<!-- 搜索区域 开始 -->
		</div><!-- col 结束 -->
	</div><!-- row 结束 -->
</div><!-- page-content 结束 -->
<!-- 备注dialog -->
<div class="modal fade"  id="noteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
</div>
<!-- 同意退款 dialog -->
<div class="modal fade"  id="agreementModal" tabindex="-1" role="dialog" aria-labelledby="agreementModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      	<div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">同意退款</h4>
      	</div>
      	<div class="modal-body">
      		<p>确认要同意该笔退款吗？退款（<em class="amount"></em>）将被返还到买家的账户中。</p>
      	</div>
      	<div class="modal-footer">
       		<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">取消</button>
   			<button id="confirmRefund" type="button" class="btn btn-primary btn-sm" data-dismiss="modal">确定</button>
      	</div>
    </div>
  </div>
</div>
<!-- 拒绝退款 dialog -->
<div class="modal fade"  id="rejectRefundModal" tabindex="-1" role="dialog" aria-labelledby="rejectRefundModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      	<div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">拒绝退款</h4>
      	</div>
      	<div class="modal-body">
      		<p>确认要拒绝（<em class="amount"></em>）该笔退款吗？</p>
      	</div>
      	<div class="modal-footer">
       		<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">取消</button>
       		<form action="/refund/reject" method="post" class="inline">
       			<input class="result-id" type="hidden" name="id" value="">
       			<input type="hidden" value="{{ App.request.getCsrfToken() }}" name="{{ App.request.csrfParam }}">
       			<button type="submit" class="btn btn-primary btn-sm">确定</button>
       		</form>
      	</div>
    </div>
  </div>
</div>
<!-- 一键退款 dialog -->
<div class="modal fade"  id="fullRefundModal" tabindex="-1" role="dialog" aria-labelledby="fullRefundModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      	<div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">一键退款</h4>
      	</div>
      	<div class="modal-body">
      		<p>确认要批量确认退款吗？</p>
      		
      	</div>
      	<div class="modal-footer">
       		<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">取消</button>
       		<button id="confirmBatchRefund" type="button" class="btn btn-primary btn-sm" data-dismiss="modal">确定</button>
      	</div>
    </div>
  </div>
</div>


<script type="text/javascript" src="/ace/js/bootstrap-datetimepicker.min.js"></script>
<script src="/ace/js/icheck.min.js"></script>
<script type="text/javascript" src="/ace/js/refund-list.js"></script>
<script type="text/javascript" src="/ace/js/note-common.js"></script>

{% endblock %}
