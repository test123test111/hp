{% set menu_name = "commodity" %}
{% set sidebar_name = "类目管理" %}
{% extends '@view/layouts/main.twig' %}
{% block content %}
    
<!--S 面包屑-->
<div class="breadcrumbs breadcrumbs-fixed" id="breadcrumbs">
    <script type="text/javascript">
      try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
    </script>
    <ul class="breadcrumb">
        <li>
            <i class="icon-home home-icon"></i>
            <a href="#">商品管理</a>
        </li>
        <li>
            <a href="/category/list/">类目管理</a>  
        </li>
        <li class="active">{{ isCreate ? '创建类目' : '编辑类目'}}</li>
    </ul>
</div>
<!--E 面包屑-->

<div class="page-content">
    <div class="row">
        {% set form = activeform.begin({'id':'create-form','layout':'horizontal','fieldConfig':{'horizontalCssClasses':{'wrapper':'col-lg-4'} } }) %}
        <div class="col-xs-12">
            <div class="space-10"></div>
            <div class="edit-page edit-category">
                <h4>类目信息</h4>
                <div class="space-10"></div>
                <ul>
                <li class="clearfix">
                    <span>类目名称</span>
                    <input type="text" class="col-xs-4" value="{{ model.name }}" name="Category[name]" placeholder="例：鞋包" />
                </li>
                <li class="clearfix">
                    <span>类目icon</span>
                    <input type="text" class="input-xlarge has-img" value="{{ model.icon }}" name="Category[icon]" id="image-0" >
                    <button data-toggle="modal" data-target="#uploadImgModal" id="uploadImg"  type="button" class="btn btn-primary btn-sm btn-space">设置图片</button>  
                </li>
                <li class="clearfix">
                    <span>类目类型</span>
                    <select name="Category[ctype]" id="categoryType" class="form-control col-xs-3">
                        <option{{ model.parent ? '' : ' selected="selected"' }} value="0">一级分类</option> 
                        <option{{ model.parent ? ' selected="selected"' : '' }} value="1">二级分类</option> 
                    </select>
                </li>
                <li class="clearfix">
                    <span>父类目</span>
                    <select name="Category[parent]" id="topCategory" class="form-control col-xs-3">
                        <option value="0">选择父类目</option>
                        {%for key, value in topCategoryArr %}
                            {% set selected = value.id ==  model.parent ? ' selected="selected"' : '' %}
                            <option {{ selected }} value="{{ value.id }}">{{ value.name }}</option> 
                        {% endfor%}
                    </select> 
                </li>
                <li class="clearfix">
                    <span>关联运营位ID</span>
                    <input type="text" class="col-xs-4" value="{{ model.position_id }}"  name="Category[position_id]"/>
                </li>
              </ul>
            </div>
            <input type="hidden" name="backUrl" value="{{ App.request.referrer }}" />
            <button class="btn btn-primary btn-sm btn-block">保存</button>
        </div>
        {{ void(form.end()) }}
    </div>
</div>
            
<div class="modal fade" id="uploadImgModal" tabindex="-1" role="dialog" aria-labelledby="uploadImgModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="uploadImgModalLabel">选择上传的图片</h4>
            </div>
            <form id="uploadimageForm" action="/category/uploadfile" method="post" target="tarframe" enctype="multipart/form-data">
                <div class="modal-body">
                    <p>
                        <input type="hidden" name="num" id="imageNum"  value="0"/>
                        <input type="hidden" value="{{ App.request.getCsrfToken() }}" name="{{ App.request.csrfParam }}">
                        <input type="file" id="upload_file" name="upload" />
                        <span id="linkImg" href="#"><i class="icon-upload-alt bigger-160"></i><em>请选择上传的图片</em></span>
                        <iframe src="" width="0" height="0" style="display:none;" name="tarframe"></iframe>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">取消</button>
                    <button type="button" id="cofirm-button" data-dismiss="modal" class="btn btn-primary btn-sm">确定</button>
                </div>
            </form>
        </div>
    </div>
</div>
                        
<script>
    ;(function(window, $) {
        bind();
        function bind() {
            $(".classified-btn").each(function(index,elem){
                var dataId = $(this).data("id");
                $("#type-" + dataId).val($(this).data("type"));
            });
            $(document).on("click",".upload-img",function(){
                $("#imageNum").val($(this).data("num"));
            }).on("change","#upload_file",function(){
                if ($(this).val() == "") {
                    $("#linkImg").find("em").html("未选择任何文件");
                } else {
                    $("#linkImg").find("em").html($(this).val());
                }
                $("#linkImg").css("color","#4c8fbd");
            });
        }

    })(window, jQuery);
    
    function stopSend(num,img){
        $("#image-"+num).val(img);
    }
    $("#cofirm-button").click(function(){
        $("#uploadimageForm").submit();
    });
    $("#categoryType").change(function(){
        if ($(this).val() == 0) {
            $('#topCategory').attr("readonly","readonly");
        } else {
            $('#topCategory').removeAttr("readonly");
        }
    });
    {{ model.parent ? "" : "$('#topCategory').attr('readonly','readonly');" }}
</script>
{% block page_scripts %}
{% endblock %}
{% endblock %}